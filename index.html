<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifestyle Medicine Assessment | Psych and Lifestyle</title>
    <!-- Professional Health-Tech Stack -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --teal: #2BB3B1;
            --light-teal: #4DC6C4;
            --pale-teal: #E6F6F5;
            --charcoal: #2F3E46;
            --slate-gray: #64748b;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC;
            color: var(--charcoal);
            line-height: 1.6;
        }
        .section-card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05);
        }
        .pillar-card {
             background-color: white;
             border-radius: 1rem;
             box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);
             border: 1px solid #e2e8f0;
             padding: 1.5rem;
             display: flex;
             flex-direction: column;
             height: 100%;
             transition: all 0.2s ease;
        }
        .pillar-card:hover {
            border-color: var(--light-teal);
            box-shadow: 0 10px 15px -3px rgba(43, 179, 177, 0.1);
        }
        .icon-background {
            width: 48px;
            height: 48px;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 9999px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--teal);
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .cta-button {
            background-image: linear-gradient(90deg, var(--teal), var(--light-teal));
            padding: 1.25rem 3rem;
            box-shadow: 0 10px 20px -5px rgba(43, 179, 177, 0.4);
            transition: all 0.2s ease;
            color: white;
            font-weight: 700;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px -5px rgba(43, 179, 177, 0.5);
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 400px;
            width: 100%;
            max-width: 600px;
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 md:p-8 max-w-6xl space-y-12">
        <header class="text-center py-6">
            <h1 class="text-4xl md:text-6xl font-bold tracking-tight" style="color: var(--teal);">Lifestyle Medicine Map</h1>
            <p class="mt-4 text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
                An evidence-based exploration of your health foundations, curated by Psych and Lifestyle.
            </p>
        </header>

        <section class="section-card p-8 md:p-12" style="background-color: var(--charcoal);">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-center" style="color: var(--light-teal);">The Ground You Stand On</h2>
                <div class="mt-8 space-y-6 text-slate-300 text-lg leading-relaxed">
                    <p>
                        Lifestyle medicine recognises that individual health is fundamentally anchored in the "Ground You Stand On"â€”the social and environmental determinants of wellbeing.
                    </p>
                    <p>
                        While this assessment focuses on personal lifestyle choices, it is essential to approach these broader circumstances with compassion. Every journey is distinct, and sustainable modification within your current context represents a significant investment in your long-term vitality.
                    </p>
                </div>
            </div>
        </section>

        <section class="section-card p-8 md:p-12">
            <div id="core-pillars-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            <div class="my-16 p-10 rounded-3xl" style="background-color: #F1F5F9;">
                <div id="additional-pillars-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto"></div>
            </div>

            <div class="py-16 border-y border-slate-100">
                <h3 class="text-2xl font-bold text-center mb-10 text-slate-700">Your Wellbeing Profile</h3>
                <div class="chart-container">
                    <canvas id="wellbeingChart" role="img" aria-label="A radar chart visualising your lifestyle scores."></canvas>
                </div>
            </div>

            <div class="mt-16 text-center space-y-8">
                <button id="get-advice-btn" class="cta-button text-xl">Generate Your Personalised Summary</button>
                <div id="advice-output" class="mt-16 text-left hidden border-t border-slate-100 pt-16">
                    <div id="spinner" class="hidden flex flex-col items-center py-12">
                        <svg class="animate-spin h-12 w-12 text-teal-500 mb-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="text-slate-600 font-semibold text-xl text-center">Synthesising your professional analysis...</p>
                    </div>
                    <div id="advice-content" class="space-y-12 pb-12"></div>
                </div>
            </div>
        </section>

        <footer class="text-center py-12 border-t border-slate-200" style="color: var(--slate-gray);">
            <p class="mt-6 font-bold text-teal-700">Psych and Lifestyle | ASLM Fellow Directed</p>
            <p class="mt-2 font-medium">&copy; 2025 Psych and Lifestyle. All rights reserved.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const corePillarsGrid = document.getElementById('core-pillars-grid');
            const additionalPillarsGrid = document.getElementById('additional-pillars-grid');
            const getAdviceBtn = document.getElementById('get-advice-btn');
            const adviceOutput = document.getElementById('advice-output');
            const adviceContent = document.getElementById('advice-content');
            const spinner = document.getElementById('spinner');

            const pillars = [
                { id: 'nourish', label: 'Nourish', question: 'Whole-food intake?', value: 5, icon: 'ðŸŽ', description: "Focusing on plant-predominant, minimally processed foods to fuel metabolic health.", color: '#D9F2D9', anchor: '0: Processed | 10: Whole Food', isCore: true },
                { id: 'move', label: 'Move', question: 'Activity consistency?', value: 5, icon: 'ðŸƒ', description: "Daily movement that supports physiological resilience.", color: '#D6EEFB', anchor: '0: Sedentary | 10: Very Active', isCore: true },
                { id: 'manageStress', label: 'Manage Stress', question: 'Coping effectiveness?', value: 5, icon: 'ðŸ§˜', description: "Developing resilience through healthy mindfulness strategies.", color: '#E6E4F9', anchor: '0: Overwhelmed | 10: Resilient', isCore: true },
                { id: 'rest', label: 'Rest', question: 'Sleep restorative quality?', value: 5, icon: 'ðŸ˜´', description: "Prioritising sleep cycles to allow for systemic recovery.", color: '#E2F0F7', anchor: '0: Poor | 10: Restorative', isCore: true },
                { id: 'connect', label: 'Connect', question: 'Social network strength?', value: 5, icon: 'ðŸ¤', description: "Nurturing relationships and fostering community belonging.", color: '#FFE4D6', anchor: '0: Isolated | 10: Connected', isCore: true },
                { id: 'avoidRisks', label: 'Avoid Risks', question: 'Substance mindfulness?', value: 5, icon: 'ðŸš­', description: "Limiting alcohol and tobacco to protect long-term health.", color: '#FAD9DC', anchor: '0: High Risk | 10: Low Risk', isCore: true },
                { id: 'purpose', label: 'Purpose', question: 'Alignment with values?', value: 5, icon: 'ðŸ§­', description: "Living in accordance with core values and life direction.", isCore: false, color: '#FAE7B5', anchor: '0: Ambiguous | 10: Aligned' },
                { id: 'nature', label: 'Nature', question: 'Time spent outdoors?', value: 5, icon: 'ðŸŒ³', description: "Engaging with the natural world to improve mood regulation.", isCore: false, color: '#DDEEE0', anchor: '0: Rarely | 10: Daily' },
            ];

            function renderPillars() {
                pillars.forEach((p, i) => {
                    const html = `<div class="pillar-card"><div class="flex-grow"><div class="flex items-center mb-4"><div class="icon-background" style="background-color: ${p.color};"><span>${p.icon}</span></div><h3 class="text-xl font-bold ml-3 text-slate-800">${p.label}</h3></div><p class="text-sm text-slate-500 leading-relaxed">${p.description}</p></div><div class="mt-8 pt-5 border-t border-slate-100"><label class="block text-sm font-bold text-slate-700 mb-4" for="range-${p.id}">${p.question}</label><div class="flex items-center gap-6"><input type="range" id="range-${p.id}" min="0" max="10" value="${p.value}" data-index="${i}" class="w-full"><span class="font-bold text-2xl w-12 text-center text-teal-600">${p.value}</span></div><p class="text-[10px] mt-4 text-center text-slate-400 italic font-bold uppercase tracking-widest">${p.anchor}</p></div></div>`;
                    if (p.isCore) corePillarsGrid.innerHTML += html; else additionalPillarsGrid.innerHTML += html;
                });
            }

            const chart = new Chart(document.getElementById('wellbeingChart'), {
                type: 'radar',
                data: {
                    labels: pillars.map(p => p.label),
                    datasets: [{
                        data: pillars.map(p => p.value),
                        backgroundColor: 'rgba(43, 179, 177, 0.15)',
                        borderColor: '#2BB3B1',
                        borderWidth: 4,
                        pointBackgroundColor: '#2BB3B1',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { min: 0, max: 10, ticks: { display: false }, pointLabels: { font: { size: 14, weight: '700' }, color: '#475569' } } }, plugins: { legend: { display: false } } }
            });

            document.body.addEventListener('input', (e) => {
                if (e.target.type === 'range') {
                    const idx = e.target.dataset.index;
                    const val = parseInt(e.target.value);
                    pillars[idx].value = val;
                    e.target.nextElementSibling.textContent = val;
                    chart.data.datasets[0].data[idx] = val;
                    chart.update();
                }
            });

            getAdviceBtn.addEventListener('click', async () => {
                adviceOutput.classList.remove('hidden');
                adviceContent.innerHTML = '';
                spinner.classList.remove('hidden');
                getAdviceBtn.disabled = true;

                const summary = pillars.map(p => `${p.label}: ${p.value}/10`).join(", ");
                const customPrompt = `Assess this wellbeing profile for Psych and Lifestyle. Australian English. Results: ${summary}. MANDATORY: Acknowledge that lifestyle change is a profound investment in future health. MANDATORY: State that if unsure, please discuss with a health professional.`;

                try {
                    // Correcting origin resolution for Netlify production environments
                    const currentOrigin = (window.location.origin === "null" || !window.location.origin) 
                        ? window.location.href.split('?')[0].split('#')[0].replace(/\/$/, '') 
                        : window.location.origin;
                    
                    const apiEndpoint = `${currentOrigin}/.netlify/functions/gemini`;

                    const response = await fetch(apiEndpoint, { 
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: customPrompt }) 
                    });

                    if (!response.ok) {
                        const err = await response.json().catch(() => ({}));
                        throw new Error(err.error || `Error ${response.status}`);
                    }
                    
                    const data = await response.json(); 

                    if (!data || !data.intro) throw new Error("Synthesis engine returned invalid data structure.");

                    let html = `<div class="bg-teal-50 border-l-4 border-teal-500 p-8 rounded-r-3xl"><p class="text-xl italic font-medium text-teal-900">"${data.intro}"</p></div>`;
                    
                    if (data.strengths?.length) {
                        html += `<div class="bg-green-50 p-8 rounded-3xl mt-8"><h3 class="text-2xl font-bold text-green-800 mb-6">ðŸŒŸ Established Foundations</h3><div class="grid md:grid-cols-2 gap-6">`;
                        data.strengths.forEach(s => {
                            html += `<div class="bg-white p-6 rounded-2xl shadow-sm border border-green-100"><strong class="text-green-700 block text-lg mb-1">${s.label}</strong><p class="text-green-900 text-sm leading-relaxed">${s.analysis}</p></div>`;
                        });
                        html += `</div></div>`;
                    }
                    
                    if (data.steps?.length) {
                        html += `<div class="space-y-10 mt-12">`;
                        data.steps.forEach(a => {
                            html += `<div class="bg-white border border-slate-200 rounded-3xl p-8 shadow-sm"><h3 class="text-2xl font-bold text-teal-800 mb-6">ðŸŒ± Opportunity for Growth: ${a.label}</h3><ul class="grid md:grid-cols-2 gap-4">`;
                            if (a.advice) a.advice.forEach(step => {
                                html += `<li class="flex items-start gap-3 bg-slate-50 p-5 rounded-2xl"><span class="text-teal-500 text-xl">âœ“</span><span class="text-slate-700 font-medium">${step}</span></li>`;
                            });
                            html += `</ul></div>`;
                        });
                        html += `</div>`;
                    }

                    html += `<div class="text-center p-10 bg-blue-50 rounded-3xl mt-12 text-blue-900 border border-blue-100"><p class="text-xl font-bold mb-4">A Profound Investment in Your Future</p><p class="text-lg leading-relaxed max-w-3xl mx-auto">Sustainable lifestyle modification is one of the most powerful clinical interventions available. If you are unsure how to begin, please discuss these findings with a health professional.</p></div>`;

                    adviceContent.innerHTML = html;
                    adviceContent.scrollIntoView({ behavior: 'smooth' });
                } catch (e) {
                    console.error("Connection Error:", e);
                    adviceContent.innerHTML = `<div class="text-center p-12 bg-red-50 text-red-700 rounded-3xl border-2 border-red-100 max-w-2xl mx-auto"><h4 class="text-2xl font-bold mb-2">Technical Connection Issue</h4><p class="font-medium text-lg">${e.message}</p></div>`;
                } finally {
                    spinner.classList.add('hidden');
                    getAdviceBtn.disabled = false;
                }
            });

            renderPillars();
        });
    </script>
</body>
</html>
